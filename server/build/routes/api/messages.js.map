{"version":3,"file":"messages.js","names":["_express","require","_requireJwtAuth","_interopRequireDefault","_Message","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","router","Router","req","res","messages","Message","find","sort","createdAt","populate","json","map","m","toJSON","err","status","message","findById","params","id","post","requireJwtAuth","error","validateMessage","body","details","create","text","user","execPopulate","delete","tempMessage","role","findByIdAndRemove","put","findByIdAndUpdate","new","_default","exports"],"sources":["../../../src/routes/api/messages.js"],"sourcesContent":["import { Router } from 'express';\nimport requireJwtAuth from '../../middleware/requireJwtAuth';\nimport Message, { validateMessage } from '../../models/Message';\n\nconst router = Router();\n\nrouter.get('/', async (req, res) => {\n  try {\n    const messages = await Message.find().sort({ createdAt: 'desc' }).populate('user');\n\n    res.json({\n      messages: messages.map((m) => {\n        return m.toJSON();\n      }),\n    });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.get('/:id', async (req, res) => {\n  try {\n    const message = await Message.findById(req.params.id).populate('user');\n    if (!message) return res.status(404).json({ message: 'No message found.' });\n    res.json({ message: message.toJSON() });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.post('/', requireJwtAuth, async (req, res) => {\n  const { error } = validateMessage(req.body);\n  if (error) return res.status(400).json({ message: error.details[0].message });\n\n  try {\n    let message = await Message.create({\n      text: req.body.text,\n      user: req.user.id,\n    });\n    message = await message.populate('user').execPopulate();\n\n    res.status(200).json({ message: message.toJSON() });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.delete('/:id', requireJwtAuth, async (req, res) => {\n  try {\n    const tempMessage = await Message.findById(req.params.id).populate('user');\n    if (!(tempMessage.user.id === req.user.id || req.user.role === 'ADMIN'))\n      return res.status(400).json({ message: 'Not the message owner or admin.' });\n\n    const message = await Message.findByIdAndRemove(req.params.id).populate('user');\n    if (!message) return res.status(404).json({ message: 'No message found.' });\n    res.status(200).json({ message });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.put('/:id', requireJwtAuth, async (req, res) => {\n  const { error } = validateMessage(req.body);\n  if (error) return res.status(400).json({ message: error.details[0].message });\n\n  try {\n    const tempMessage = await Message.findById(req.params.id).populate('user');\n    if (!(tempMessage.user.id === req.user.id || req.user.role === 'ADMIN'))\n      return res.status(400).json({ message: 'Not the message owner or admin.' });\n\n    let message = await Message.findByIdAndUpdate(\n      req.params.id,\n      { text: req.body.text, user: tempMessage.user.id },\n      { new: true },\n    );\n    if (!message) return res.status(404).json({ message: 'No message found.' });\n    message = await message.populate('user').execPopulate();\n\n    res.status(200).json({ message });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nexport default router;\n"],"mappings":";;;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,eAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,QAAA,GAAAC,uBAAA,CAAAJ,OAAA;AAAgE,SAAAK,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAF,wBAAAM,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAd,uBAAAQ,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEhE,MAAMiB,MAAM,GAAG,IAAAC,eAAM,GAAE;AAEvBD,MAAM,CAACZ,GAAG,CAAC,GAAG,EAAE,OAAOc,GAAG,EAAEC,GAAG,KAAK;EAClC,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMC,gBAAO,CAACC,IAAI,EAAE,CAACC,IAAI,CAAC;MAAEC,SAAS,EAAE;IAAO,CAAC,CAAC,CAACC,QAAQ,CAAC,MAAM,CAAC;IAElFN,GAAG,CAACO,IAAI,CAAC;MACPN,QAAQ,EAAEA,QAAQ,CAACO,GAAG,CAAEC,CAAC,IAAK;QAC5B,OAAOA,CAAC,CAACC,MAAM,EAAE;MACnB,CAAC;IACH,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZX,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAwB,CAAC,CAAC;EAC5D;AACF,CAAC,CAAC;AAEFhB,MAAM,CAACZ,GAAG,CAAC,MAAM,EAAE,OAAOc,GAAG,EAAEC,GAAG,KAAK;EACrC,IAAI;IACF,MAAMa,OAAO,GAAG,MAAMX,gBAAO,CAACY,QAAQ,CAACf,GAAG,CAACgB,MAAM,CAACC,EAAE,CAAC,CAACV,QAAQ,CAAC,MAAM,CAAC;IACtE,IAAI,CAACO,OAAO,EAAE,OAAOb,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAoB,CAAC,CAAC;IAC3Eb,GAAG,CAACO,IAAI,CAAC;MAAEM,OAAO,EAAEA,OAAO,CAACH,MAAM;IAAG,CAAC,CAAC;EACzC,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZX,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAwB,CAAC,CAAC;EAC5D;AACF,CAAC,CAAC;AAEFhB,MAAM,CAACoB,IAAI,CAAC,GAAG,EAAEC,uBAAc,EAAE,OAAOnB,GAAG,EAAEC,GAAG,KAAK;EACnD,MAAM;IAAEmB;EAAM,CAAC,GAAG,IAAAC,wBAAe,EAACrB,GAAG,CAACsB,IAAI,CAAC;EAC3C,IAAIF,KAAK,EAAE,OAAOnB,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;IAAEM,OAAO,EAAEM,KAAK,CAACG,OAAO,CAAC,CAAC,CAAC,CAACT;EAAQ,CAAC,CAAC;EAE7E,IAAI;IACF,IAAIA,OAAO,GAAG,MAAMX,gBAAO,CAACqB,MAAM,CAAC;MACjCC,IAAI,EAAEzB,GAAG,CAACsB,IAAI,CAACG,IAAI;MACnBC,IAAI,EAAE1B,GAAG,CAAC0B,IAAI,CAACT;IACjB,CAAC,CAAC;IACFH,OAAO,GAAG,MAAMA,OAAO,CAACP,QAAQ,CAAC,MAAM,CAAC,CAACoB,YAAY,EAAE;IAEvD1B,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAEA,OAAO,CAACH,MAAM;IAAG,CAAC,CAAC;EACrD,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZX,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAwB,CAAC,CAAC;EAC5D;AACF,CAAC,CAAC;AAEFhB,MAAM,CAAC8B,MAAM,CAAC,MAAM,EAAET,uBAAc,EAAE,OAAOnB,GAAG,EAAEC,GAAG,KAAK;EACxD,IAAI;IACF,MAAM4B,WAAW,GAAG,MAAM1B,gBAAO,CAACY,QAAQ,CAACf,GAAG,CAACgB,MAAM,CAACC,EAAE,CAAC,CAACV,QAAQ,CAAC,MAAM,CAAC;IAC1E,IAAI,EAAEsB,WAAW,CAACH,IAAI,CAACT,EAAE,KAAKjB,GAAG,CAAC0B,IAAI,CAACT,EAAE,IAAIjB,GAAG,CAAC0B,IAAI,CAACI,IAAI,KAAK,OAAO,CAAC,EACrE,OAAO7B,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAkC,CAAC,CAAC;IAE7E,MAAMA,OAAO,GAAG,MAAMX,gBAAO,CAAC4B,iBAAiB,CAAC/B,GAAG,CAACgB,MAAM,CAACC,EAAE,CAAC,CAACV,QAAQ,CAAC,MAAM,CAAC;IAC/E,IAAI,CAACO,OAAO,EAAE,OAAOb,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAoB,CAAC,CAAC;IAC3Eb,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM;IAAQ,CAAC,CAAC;EACnC,CAAC,CAAC,OAAOF,GAAG,EAAE;IACZX,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAwB,CAAC,CAAC;EAC5D;AACF,CAAC,CAAC;AAEFhB,MAAM,CAACkC,GAAG,CAAC,MAAM,EAAEb,uBAAc,EAAE,OAAOnB,GAAG,EAAEC,GAAG,KAAK;EACrD,MAAM;IAAEmB;EAAM,CAAC,GAAG,IAAAC,wBAAe,EAACrB,GAAG,CAACsB,IAAI,CAAC;EAC3C,IAAIF,KAAK,EAAE,OAAOnB,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;IAAEM,OAAO,EAAEM,KAAK,CAACG,OAAO,CAAC,CAAC,CAAC,CAACT;EAAQ,CAAC,CAAC;EAE7E,IAAI;IACF,MAAMe,WAAW,GAAG,MAAM1B,gBAAO,CAACY,QAAQ,CAACf,GAAG,CAACgB,MAAM,CAACC,EAAE,CAAC,CAACV,QAAQ,CAAC,MAAM,CAAC;IAC1E,IAAI,EAAEsB,WAAW,CAACH,IAAI,CAACT,EAAE,KAAKjB,GAAG,CAAC0B,IAAI,CAACT,EAAE,IAAIjB,GAAG,CAAC0B,IAAI,CAACI,IAAI,KAAK,OAAO,CAAC,EACrE,OAAO7B,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAkC,CAAC,CAAC;IAE7E,IAAIA,OAAO,GAAG,MAAMX,gBAAO,CAAC8B,iBAAiB,CAC3CjC,GAAG,CAACgB,MAAM,CAACC,EAAE,EACb;MAAEQ,IAAI,EAAEzB,GAAG,CAACsB,IAAI,CAACG,IAAI;MAAEC,IAAI,EAAEG,WAAW,CAACH,IAAI,CAACT;IAAG,CAAC,EAClD;MAAEiB,GAAG,EAAE;IAAK,CAAC,CACd;IACD,IAAI,CAACpB,OAAO,EAAE,OAAOb,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAoB,CAAC,CAAC;IAC3EA,OAAO,GAAG,MAAMA,OAAO,CAACP,QAAQ,CAAC,MAAM,CAAC,CAACoB,YAAY,EAAE;IAEvD1B,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM;IAAQ,CAAC,CAAC;EACnC,CAAC,CAAC,OAAOF,GAAG,EAAE;IACZX,GAAG,CAACY,MAAM,CAAC,GAAG,CAAC,CAACL,IAAI,CAAC;MAAEM,OAAO,EAAE;IAAwB,CAAC,CAAC;EAC5D;AACF,CAAC,CAAC;AAAC,IAAAqB,QAAA,GAEYrC,MAAM;AAAAsC,OAAA,CAAArD,OAAA,GAAAoD,QAAA"}