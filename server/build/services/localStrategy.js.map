{"version":3,"file":"localStrategy.js","names":["_passport","_interopRequireDefault","require","_passportLocal","_joi","_User","_validators","obj","__esModule","default","passportLogin","PassportLocalStrategy","usernameField","passwordField","session","passReqToCallback","req","email","password","done","error","Joi","validate","body","loginSchema","message","details","user","User","findOne","trim","comparePassword","err","isMatch","passport","use"],"sources":["../../src/services/localStrategy.js"],"sourcesContent":["import passport from 'passport';\nimport { Strategy as PassportLocalStrategy } from 'passport-local';\nimport Joi from 'joi';\n\nimport User from '../models/User';\nimport { loginSchema } from './validators';\n\nconst passportLogin = new PassportLocalStrategy(\n  {\n    usernameField: 'email',\n    passwordField: 'password',\n    session: false,\n    passReqToCallback: true,\n  },\n  async (req, email, password, done) => {\n    const { error } = Joi.validate(req.body, loginSchema);\n    if (error) {\n      return done(null, false, { message: error.details[0].message });\n    }\n\n    try {\n      const user = await User.findOne({ email: email.trim() });\n      if (!user) {\n        return done(null, false, { message: 'Email does not exists.' });\n      }\n\n      user.comparePassword(password, function (err, isMatch) {\n        if (err) {\n          return done(err);\n        }\n        if (!isMatch) {\n          return done(null, false, { message: 'Incorrect password.' });\n        }\n\n        return done(null, user);\n      });\n    } catch (err) {\n      return done(err);\n    }\n  },\n);\n\npassport.use(passportLogin);\n"],"mappings":";;AAAA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,cAAA,GAAAD,OAAA;AACA,IAAAE,IAAA,GAAAH,sBAAA,CAAAC,OAAA;AAEA,IAAAG,KAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,WAAA,GAAAJ,OAAA;AAA2C,SAAAD,uBAAAM,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAE3C,MAAMG,aAAa,GAAG,IAAIC,uBAAqB,CAC7C;EACEC,aAAa,EAAE,OAAO;EACtBC,aAAa,EAAE,UAAU;EACzBC,OAAO,EAAE,KAAK;EACdC,iBAAiB,EAAE;AACrB,CAAC,EACD,OAAOC,GAAG,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,IAAI,KAAK;EACpC,MAAM;IAAEC;EAAM,CAAC,GAAGC,YAAG,CAACC,QAAQ,CAACN,GAAG,CAACO,IAAI,EAAEC,uBAAW,CAAC;EACrD,IAAIJ,KAAK,EAAE;IACT,OAAOD,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE;MAAEM,OAAO,EAAEL,KAAK,CAACM,OAAO,CAAC,CAAC,CAAC,CAACD;IAAQ,CAAC,CAAC;EACjE;EAEA,IAAI;IACF,MAAME,IAAI,GAAG,MAAMC,aAAI,CAACC,OAAO,CAAC;MAAEZ,KAAK,EAAEA,KAAK,CAACa,IAAI;IAAG,CAAC,CAAC;IACxD,IAAI,CAACH,IAAI,EAAE;MACT,OAAOR,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE;QAAEM,OAAO,EAAE;MAAyB,CAAC,CAAC;IACjE;IAEAE,IAAI,CAACI,eAAe,CAACb,QAAQ,EAAE,UAAUc,GAAG,EAAEC,OAAO,EAAE;MACrD,IAAID,GAAG,EAAE;QACP,OAAOb,IAAI,CAACa,GAAG,CAAC;MAClB;MACA,IAAI,CAACC,OAAO,EAAE;QACZ,OAAOd,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE;UAAEM,OAAO,EAAE;QAAsB,CAAC,CAAC;MAC9D;MAEA,OAAON,IAAI,CAAC,IAAI,EAAEQ,IAAI,CAAC;IACzB,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOK,GAAG,EAAE;IACZ,OAAOb,IAAI,CAACa,GAAG,CAAC;EAClB;AACF,CAAC,CACF;AAEDE,iBAAQ,CAACC,GAAG,CAACzB,aAAa,CAAC"}