{"version":3,"file":"seed.js","names":["_faker","_interopRequireDefault","require","_path","_User","_Message","_utils","_constants","obj","__esModule","default","seedDb","console","log","User","deleteMany","Message","deleteAllAvatars","join","__dirname","IMAGES_FOLDER_PATH","usersPromises","Array","keys","map","index","i","user","provider","username","email","password","name","faker","findName","avatar","bio","lorem","sentences","role","registerUser","Promise","all","save","messagePromises","message","text","users","find","messages","threeMessagesIds","slice","m","id","updateOne","_id","$push","j","Math","floor","$set","exports"],"sources":["../../src/utils/seed.js"],"sourcesContent":["import faker from 'faker';\nimport { join } from 'path';\n\nimport User from '../models/User';\nimport Message from '../models/Message';\nimport { deleteAllAvatars } from './utils';\nimport { IMAGES_FOLDER_PATH } from './constants';\n\nexport const seedDb = async () => {\n  console.log('Seeding database...');\n\n  await User.deleteMany({});\n  await Message.deleteMany({});\n  await deleteAllAvatars(join(__dirname, '../..', IMAGES_FOLDER_PATH));\n\n  // create 3 users\n  const usersPromises = [...Array(3).keys()].map((index, i) => {\n    const user = new User({\n      provider: 'email',\n      username: `user${index}`,\n      email: `email${index}@email.com`,\n      password: '123456789',\n      name: faker.name.findName(),\n      // avatar: faker.image.avatar(),\n      avatar: `avatar${index}.jpg`,\n      bio: faker.lorem.sentences(3),\n    });\n\n    if (index === 0) {\n      user.role = 'ADMIN';\n    }\n    user.registerUser(user, () => {});\n\n    return user;\n  });\n\n  await Promise.all(\n    usersPromises.map(async (user) => {\n      await user.save();\n    }),\n  );\n\n  // create 9 messages\n  const messagePromises = [...Array(9).keys()].map((index, i) => {\n    const message = new Message({\n      text: faker.lorem.sentences(3),\n    });\n    return message;\n  });\n\n  await Promise.all(\n    messagePromises.map(async (message) => {\n      await message.save();\n    }),\n  );\n\n  const users = await User.find();\n  const messages = await Message.find();\n\n  // every user 3 messages\n  users.map(async (user, index) => {\n    const threeMessagesIds = messages.slice(index * 3, index * 3 + 3).map((m) => m.id);\n    await User.updateOne({ _id: user.id }, { $push: { messages: threeMessagesIds } });\n  });\n\n  // 0,1,2 message belong to user 0 ...\n  messages.map(async (message, index) => {\n    const j = Math.floor(index / 3);\n    const user = users[j];\n    await Message.updateOne(\n      { _id: message.id },\n      {\n        $set: {\n          user: user.id,\n        },\n      },\n    );\n  });\n};\n"],"mappings":"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"}